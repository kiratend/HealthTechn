<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard | MedVentory</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="admin.css">

</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="admin.html">MedVentory Admin</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle position-relative" href="#" id="notificationDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="fas fa-bell"></i>
              <span class="notification-badge" id="notification-count">3</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-end notification-dropdown" aria-labelledby="notificationDropdown">
              <li class="dropdown-header">Notifications</li>
              <li><hr class="dropdown-divider"></li>
              <div id="notification-list">
                <!-- Notifications will be populated here by JavaScript -->
              </div>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item text-center" href="#" onclick="markAllAsRead()">Mark all as read</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="logout.html"><i class="fas fa-sign-out-alt"></i> Log Out</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <div class="hero-section">
    <h1 class="display-5">Medical Supply Management</h1>
    <p class="lead">Precision in Supply, Excellence in Care.</p>
  </div>

  <!-- Dashboard Summary -->
  <div class="container mt-4">
    <div class="row g-4 mb-4">
      <div class="col-md-3">
        <div class="dashboard-card bg-success text-white">
          <i class="fas fa-box"></i>
          <h5 class="mt-2">Total Supplies</h5>
          <p id="total-supplies">1000</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="dashboard-card bg-warning text-dark">
          <i class="fas fa-truck"></i>
          <h5 class="mt-2">Orders Pending</h5>
          <p id="orders-pending">5</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="dashboard-card bg-danger text-white">
          <i class="fas fa-exclamation-triangle"></i>
          <h5 class="mt-2">Low Stock Items</h5>
          <p id="low-stock">2</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="dashboard-card bg-info text-white">
          <i class="fas fa-bell"></i>
          <h5 class="mt-2">Unread Notifications</h5>
          <p id="unread-notifications">3</p>
        </div>
      </div>
    </div>

    <!-- System Inventory Section -->
    <div class="system-inventory-section">
      <h3 class="mb-4">System Inventory</h3>
      <div class="row">
        <div class="col-md-6">
          <div class="system-card">
            <div class="system-card-header">
              <i class="fas fa-server me-2"></i>Server Status
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Database Server</span>
              <span class="system-status status-operational">Operational</span>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Application Server</span>
              <span class="system-status status-operational">Operational</span>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Backup Server</span>
              <span class="system-status status-maintenance">Maintenance</span>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Uptime</span>
              <span class="system-info-value">99.8%</span>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="system-card">
            <div class="system-card-header">
              <i class="fas fa-database me-2"></i>Storage Information
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Database Size</span>
              <span class="system-info-value">245 MB / 500 MB</span>
            </div>
            <div class="progress mb-2">
              <div class="progress-bar bg-success" role="progressbar" style="width: 49%" aria-valuenow="49" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Backup Storage</span>
              <span class="system-info-value">1.2 GB / 2 GB</span>
            </div>
            <div class="progress mb-2">
              <div class="progress-bar bg-warning" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Log Files</span>
              <span class="system-info-value">85 MB / 100 MB</span>
            </div>
            <div class="progress">
              <div class="progress-bar bg-info" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-md-6">
          <div class="system-card">
            <div class="system-card-header">
              <i class="fas fa-users me-2"></i>User Activity
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Active Users</span>
              <span class="system-info-value">12</span>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Last Login</span>
              <span class="system-info-value">Today, 09:45 AM</span>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Failed Login Attempts</span>
              <span class="system-info-value">2</span>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="system-card">
            <div class="system-card-header">
              <i class="fas fa-tools me-2"></i>System Health
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Last Backup</span>
              <span class="system-info-value">Yesterday, 02:00 AM</span>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">Security Updates</span>
              <span class="system-status status-issue">Pending</span>
            </div>
            <div class="system-info-item">
              <span class="system-info-label">System Load</span>
              <span class="system-info-value">42%</span>
            </div>
            <div class="progress">
              <div class="progress-bar bg-success" role="progressbar" style="width: 42%" aria-valuenow="42" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Supply Table -->
    <div class="card shadow-sm mb-4 mt-4">
      <div class="card-header bg-success text-white fw-bold">
        Supply Inventory
      </div>
      <div class="card-body p-0">
        <table class="table table-bordered mb-0">
          <thead class="table-light">
            <tr>
              <th>Item</th>
              <th>Stock</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody id="supply-list"></tbody>
        </table>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="d-flex flex-wrap gap-2">
      <button class="btn btn-success" onclick="addSupply()">
        <i class="fas fa-plus"></i> Add New Supply
      </button>
      <button class="btn btn-outline-success" onclick="manageOrders()">
        <i class="fas fa-cogs"></i> Manage Orders
      </button>
      <button class="btn btn-outline-success" onclick="viewRequests()">
        <i class="fas fa-shopping-cart"></i> View Purchase Requests
      </button>
      <button class="btn btn-outline-info" onclick="viewSystemLogs()">
        <i class="fas fa-file-alt"></i> View System Logs
      </button>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer mt-5">
    <p>&copy; 2025 MedVentory. All Rights Reserved.</p>
  </div>

  <!-- JavaScript -->
  <script>
    let supplies = [
      { name: "Masks", stock: 120 },
      { name: "Gloves", stock: 80 },
      { name: "Syringes", stock: 150 },
      { name: "Sanitizers", stock: 60 }
    ];

    let notifications = [
      {
        id: 1,
        title: "Procurement Request",
        message: "New purchase request for medical supplies awaiting approval",
        department: "procurement",
        timestamp: new Date(Date.now() - 30 * 60 * 1000), // 30 minutes ago
        read: false
      },
      {
        id: 2,
        title: "Budget Approval",
        message: "Q3 budget for medical supplies requires your approval",
        department: "finance",
        timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
        read: false
      },
      {
        id: 3,
        title: "Supplier Contract Renewal",
        message: "Contract with MedSupply Inc. expires in 15 days",
        department: "procurement",
        timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000), // 5 hours ago
        read: false
      },
      {
        id: 4,
        title: "Payment Processed",
        message: "Payment for last month's supplies has been processed",
        department: "finance",
        timestamp: new Date(Date.now() - 24 * 60 * 60 * 1000), // 1 day ago
        read: true
      },
      {
        id: 5,
        title: "New Supplier Added",
        message: "Global Medical Supplies has been added to the supplier database",
        department: "procurement",
        timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 days ago
        read: true
      }
    ];

    function loadSupplies() {
      const supplyList = document.getElementById("supply-list");
      supplyList.innerHTML = "";
      supplies.forEach((item, index) => {
        supplyList.innerHTML += `
          <tr>
            <td>${item.name}</td>
            <td>${item.stock}</td>
            <td class="text-center">
              <button class="btn btn-sm btn-outline-success" onclick="restock(${index})">
                <i class="fas fa-plus-circle"></i> Restock
              </button>
            </td>
          </tr>
        `;
      });

      document.getElementById("total-supplies").textContent = supplies.reduce((sum, item) => sum + item.stock, 0);
      document.getElementById("low-stock").textContent = supplies.filter(item => item.stock < 100).length;
    }

    function loadNotifications() {
      const notificationList = document.getElementById("notification-list");
      notificationList.innerHTML = "";
      
      // Sort notifications by timestamp (newest first)
      const sortedNotifications = [...notifications].sort((a, b) => b.timestamp - a.timestamp);
      
      // Display only the 5 most recent notifications in the dropdown
      const recentNotifications = sortedNotifications.slice(0, 5);
      
      recentNotifications.forEach(notification => {
        const timeAgo = getTimeAgo(notification.timestamp);
        const unreadClass = notification.read ? "" : "unread";
        
        notificationList.innerHTML += `
          <li>
            <div class="notification-item ${unreadClass} ${notification.department}">
              <div class="d-flex justify-content-between">
                <strong>${notification.title}</strong>
                <span class="notification-time">${timeAgo}</span>
              </div>
              <div class="mt-1">${notification.message}</div>
              <div class="mt-2">
                <button class="btn btn-sm ${notification.read ? 'btn-outline-secondary' : 'btn-primary'}" onclick="markAsRead(${notification.id})">
                  ${notification.read ? 'Mark as Unread' : 'Mark as Read'}
                </button>
                <button class="btn btn-sm btn-outline-danger ms-1" onclick="deleteNotification(${notification.id})">
                  Delete
                </button>
              </div>
            </div>
          </li>
        `;
      });
      
      // Update notification count
      const unreadCount = notifications.filter(n => !n.read).length;
      document.getElementById("notification-count").textContent = unreadCount;
      document.getElementById("unread-notifications").textContent = unreadCount;
    }

    function getTimeAgo(timestamp) {
      const now = new Date();
      const diffMs = now - timestamp;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) return "Just now";
      if (diffMins < 60) return `${diffMins} min ago`;
      if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
      return `${diffDays} day${diffDays > 1 ? 's' : ''} ago`;
    }

    function markAsRead(notificationId) {
      const notification = notifications.find(n => n.id === notificationId);
      if (notification) {
        notification.read = !notification.read;
        loadNotifications();
      }
    }

    function markAllAsRead() {
      notifications.forEach(notification => {
        notification.read = true;
      });
      loadNotifications();
    }

    function deleteNotification(notificationId) {
      notifications = notifications.filter(n => n.id !== notificationId);
      loadNotifications();
    }

    function restock(index) {
      supplies[index].stock += 10;
      loadSupplies();
    }

    function addSupply() {
      const name = prompt("Enter supply name:");
      const stock = prompt("Enter initial stock:");
      if (name && !isNaN(stock) && stock >= 0) {
        supplies.push({ name, stock: parseInt(stock) });
        loadSupplies();
      } else {
        alert("Invalid input. Supply not added.");
      }
    }

    function manageOrders() {
      window.location.href = "manage-orders.html";
    }

    function viewRequests() {
      window.location.href = "purchase-requests.html";
    }

    function viewSystemLogs() {
      alert("System logs would be displayed here in a real application.");
    }

    // Simulate receiving new notifications
    function simulateNewNotification() {
      const departments = ["procurement", "finance"];
      const titles = {
        procurement: ["New Supplier Quote", "Purchase Order Update", "Inventory Audit Request"],
        finance: ["Budget Review Required", "Payment Approval Needed", "Expense Report Submitted"]
      };
      
      const department = departments[Math.floor(Math.random() * departments.length)];
      const title = titles[department][Math.floor(Math.random() * titles[department].length)];
      const messages = {
        procurement: [
          "A new supplier has submitted a quote for medical supplies",
          "Purchase order #PO-2023-0456 has been updated",
          "Quarterly inventory audit scheduled for next week"
        ],
        finance: [
          "Please review the budget allocation for Q4 medical supplies",
          "Payment for vendor MedSupply Corp requires your approval",
          "New expense report from procurement department needs review"
        ]
      };
      
      const message = messages[department][Math.floor(Math.random() * messages[department].length)];
      
      const newNotification = {
        id: notifications.length > 0 ? Math.max(...notifications.map(n => n.id)) + 1 : 1,
        title: title,
        message: message,
        department: department,
        timestamp: new Date(),
        read: false
      };
      
      notifications.unshift(newNotification);
      loadNotifications();
      
      // Show a toast notification (in a real app, you'd use a proper toast library)
      alert(`New notification: ${title}`);
    }

    window.onload = function() {
      loadSupplies();
      loadNotifications();
      
      // Simulate receiving a new notification every 30 seconds for demo purposes
      setInterval(simulateNewNotification, 30000);
    };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>